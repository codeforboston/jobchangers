# Generated by Django 3.1 on 2020-10-24 21:45

from django.db import migrations, models
from data.scripts.sql_loader import load_bls_oes_to_sql

class Migration(migrations.Migration):
    """
    Load BLS OES data for the prototype into the jobs_blsoes database (BlsOes model, created in the previous migration)
    """
    dependencies = [
        ('jobs', '0012_socdescription'),
    ]

    def forwards_source_data(apps, schema_editor):
        # Automatically loads in an empty total_transition_obs field. Was unable to get the field to work cleanly
        # with Django tests + 0014/0015 (tests would delete field & prevent back-migrations). This is a workaround.
        load_bls_oes_to_sql(
            start_year=2018,
            end_year=2019,
            table_name=None,
            soc_table_name="jobs_socdescription",
            transitions_file_path="data/occupation_transitions_public_data_set.csv")

        print("Done with forward load")

    def reverse_source_data(apps, schema_editor):
        print("Removing source data")
        migrations.RunSQL([("DELETE FROM jobs_socdescription;")])

    operations = [
        migrations.RunPython(forwards_source_data, reverse_source_data)
    ]
